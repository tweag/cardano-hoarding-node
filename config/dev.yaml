server:
  host: 0.0.0.0
  port: 3000

# Path to secrets file (can be relative or absolute)
secrets_file: secrets/dev.yaml

# Path to node sockets
node_sockets:
  tag: Local
  contents:
    node_to_client_socket: node-db/preprod/node.socket
    tracer_socket: /tmp/cardano-tracer.sock

# Path to Cardano protocol config file
protocol_config_path: config/preprod/config.json

database:
  host: postgres-data
  port: 5432
  database_name: hoard_dev
  pool:
    size: 10
    acquisition_timeout_seconds: 5
    aging_timeout_seconds: 1800
    idleness_timeout_seconds: 600

logging:
  minimum_severity: DEBUG

# Tracing configuration (OpenTelemetry)
tracing:
  enabled: true
  service_name: "hoard"
  otlp_endpoint: "http://localhost:4318"

setup:
  # Maximum number of file descriptors
  # Increase this to support many concurrent peer connections
  max_file_descriptors: 16384

peer_manager:
  # Cooldown period after a peer failure before retrying (in seconds)
  peer_failure_cooldown_seconds: 300
  max_collector_lifetime_seconds: 3000 # 50 minutes
  max_concurrent_collectors: 150

node_to_node:
  # Timeout for TCP connection handshake (in seconds)
  # This only affects the initial connection, not established connections
  connection_timeout_seconds: 10

# Cardano protocols configuration
cardano_protocols:
  peer_sharing:
    request_interval_microseconds: 3600000000 # 1 hour
    request_amount: 100
    maximum_ingress_queue: 1000
  keep_alive:
    interval_microseconds: 10000000 # 10 seconds
    maximum_ingress_queue: 1000
  block_fetch:
    batch_size: 10
    batch_timeout_microseconds: 1000000 # 1 second
    maximum_ingress_queue: 393216 # 384 KiB
  chain_sync:
    maximum_ingress_queue: 1200


cardano_protocol_handles:
  block_fetch:
    max_concurrent_fetches: 1

# Monitoring configuration
monitoring:
  polling_interval_seconds: 10
  environment: "dev"
  prometheus:
    port: 9090
    scrape_interval: "5s"
    evaluation_interval: "5s"
    targets:
      hoard: "localhost:3000"
      node_exporter: "localhost:9100"
  grafana:
    port: 3001
    host: "0.0.0.0"
    admin_user: "admin"
    admin_password: "admin"
  tempo:
    http_port: 3200
    block_retention: "24h"
    max_block_duration: "5m"
  loki:
    http_port: 3100
    retention_period: "24h"
  node_exporter:
    port: 9100

quota:
  entry_ttl: 43200 # 12 hours
  cleanup_interval: 3600 # 1 hour

block_eviction:
  eviction_interval_seconds: 3600 # 1 hour

# Cardano node integration configuration
cardano_node_integration:
  ssh_server_alive_interval_seconds: 60
  immutable_tip_refresh_seconds: 20
